第三章：网络层

 

两种服务（网络层想运输层提供）：

虚电路服务：发送端和接收端相同的分组都沿着同一条虚电路传送（先发先到）

数据报服务（现在所采用的服务）：发送端和接收端相同的分组可能沿着不同路径传送（先发不一定先到）

 

网络层关注的是如何将分组从源端沿着网络路劲送达目的端（就是快递）

在计算机通信中，可靠交付应当由端系统（两端：发送端和接收端）而不是网络（物流公司）负责

 

 

虚电路：逻辑上的连接，所有的分组都沿着这条逻辑连接（同一条虚电路）按照配置好的方式传送，并不是真正建立了一条物理连接（目的地固定，可以不写地址）

 

 

数据报：网络层向上只提供简单灵活的，无连接的，尽最大努力交付（不可靠）的数据报服务

网络在发送分组是不需要先建立连接，每一个分组（即IP数据报）独立发送，与其前后的分组无关（不进行编号）

网络层提供的服务不可靠

 

尽最大努力交付的好处：

网络中的路由器造价简单便宜（相比较交换机）

如果需要可靠的通信，则由运输层服务

网络的造价大大降低

 

 

数据包写上地址之后，路由器根据里面的路由表临时决定（网络的健壮性）怎么走

 

 

 

 

 

网际协议IP

网络互联的设备：中间设备又称中间系统或中继系统：

物理层中继系统：转发器（集线器）（用于信号放大）

数据链路层中继系统：网桥或桥接器（交换机）

网络层中继系统：路由器

网络层以上的中继系统：网关（现在网关指的是路由器的接口）

 

 

虚拟互联网络的意义：

互联起来的各种物理网络的异构性本来是客观存在的，但是我们利用IP协议就可以使这些性能各异的网络从用户看起来好像是一个统一的网络，从而屏蔽掉一些不需要的细节

使用IP协议的虚拟互联网络课简称为IP网

 

网络的4个协议：

网际协议IP：其他三个协议都依赖于IP协议

地址解析协议ARP：负责解析对方网卡，计算机，路由器的MAC地址

网际控制报文协议ICMP：报告网络故障（比如超时）

网际组管理协议IGMP

 

层次化IP地址：网络ID和主机ID

 


 

 

 

127：本地环回地址（自己的地址，即127.0.0.x）（不属于A类地址）

 

 

一个路由器的不同接口必须是不同的网段

路由器的接口（类似网卡：有IP地址和MAC地址）

 

 

 

特殊的几个地址：

127.0.0.1  本地环回地址

169.254.0.0 计算机没有手动分配地址时自动分配的地址，无法访问网络，需要一个正确的地址

10.0.0.0 保留的A类私网地址，即互联网上没有分配给服务器来用，留给企业或政府或学校用（不同的学校都是用10.0.0.0网段，因为不同的学校之间没打算通信，所以即使地址有可能重叠也没关系）

172.16.0.0――172.31.0.0保留的B类私网地址

192.168.0.0――192.168.255.0保留的C类私网地址

 

私网地址外部无法连接

 

 

 

子网掩码的作用：将IP地址划分成网络地址和主机地址两部分，必须结合IP地址一起使用（将子网掩码与其IP地址进行与运算，从而可以得到该计算机所处的网段），不能单独存在

 

 

要向不同网段的计算机传送数据――将数据包给网关

也可以更改子网掩码，将原本两个不同的网段，通过和子网掩码进行与运算后得到的结果相同，此时传数据则可以直接传送而不用传给网关，因此子网掩码写错会造成网络故障，必须写正确

 

 

子网划分（意义：充分利用IP地址）:

主机地址不全为1或全为0

全0表示网段

全1则是广播，网段中所有计算机都能收到

 

 

 

路由器的地址就是此网段的网关，网关一般使用的是本网段的第一个地址

 

 

 

 

 

 

 

点对点网络的子网掩码最好是252：剩4个地址，只有2个能用

 

除了等长子网的划分，还要会变长子网的划分

等长子网的掩码相同，变长子网的掩码不同

此处计算题为重点

 

 

超网：用来合并网段

 

若不用超网，则须如此：在路由器的接口上加两个地址，让一个路由器的接口当两个网段的网关，此时两个网段的计算机通讯时，数据报通过路由器转发

 

 

 

不同网段的计算机通信过程：

1.     交换机给予数据帧的MAC地址转发数据帧，路由器基于数据包的IP地址转发数据包

2.     数据包（数据+IP）在传输过程不变，过网络设备数据帧（数据包+MAC）要用新的网络层地址重新封装

3.     MAC地址决定了数据帧下一跳哪个设备接收，IP地址决定了数据包的起点和终点

 

若所有计算机没有网络设备，用广播，则不用IP地址（安全问题）

 

                                  

ARP协议

动态路由选择协议都属于IP协议

ARP协议（靠广播，所以这一步很不安全）用于将IP地址解析成MAC地址

RARP协议就是请求IP地址的过程

 

知道ARP欺骗是怎么回事

ARP欺骗对策：ARP防火墙

 

 

 

IP数据报格式（IP数据包）

一个IP数据报由首部和数据两部分组成

首部的前一部分是固定长度，共20字节，是所有IP数据报必须具有的

首部的固定部分后面是一些可选字段，长度可变

版本：指定是IPv4还是IPv6

首部长度：因为有可变部分，所以需要标明

区分服务（服务质量）：标明数据部分的紧急程度（比如同时进行语音聊天和下载文件，语音的紧急程度更高），需要在计算机和路由器上都加标记，才能实现紧急的流量优先传输

总长度：占16位，所以数据报的最大长度为65535字节，且不超过最大传输单元MTU

标识：是一个计数器，用来产生数据报的标识，不是序号，每产生一个数据包就加1

标致：表示数据包是否分片

片偏移：较长的分组在分片后某片在原分组中的相对位置，片pianist以8个字节为偏移单位（片偏移记录的是原来的偏移量除以8之后的数据）

生存时间（TTL）：每过一个路由器，TTL就减1（防止数据包在网络上无线循环）

协议：记录数据报携带的数据使用何种协议，以便目的主句的IP层将数据部分上交给哪个处理过程（进程）

首部校验和：值检验数据报的首部，不采用CRC检验码而采用简单的计算方法

可选字段：用于安全措施，1到40个字节，实际上可选字段很少被使用

 

 

数据路由：路由器在不同网段转发数据包

路由：数据包不同网段通信

 

沿途的路由器必须知道到目标网路（来和回） 下一跳给哪个接口

 

 

IP转发分则的流程

静态路由：管理员添加路由表的时候，d 需要知道没有直连的网段怎么走

 

 

计算机上也有路由表：计算机的网关就是默认路由

如果计算机有两个网卡，一个连Internet，另一个连局域网，只将连Internet的网卡设置网关，另一个不设置网关（有规律的丢包），也不要设置成自己的地址（造成网络堵塞或不通），网卡是流量的出口，但是所连局域网的计算机的网卡要设置成自己的地址

 

 

 

 

ICMP协议：（网际控制报文协议）

用于探测网络有没有故障

不是高层协议，而是IP层的协议

ICMP报文作为IP层数据报的数据，加上数据报的首部，组成IP数据报

 

类型：包括ICMP差错报告报文和ICMP询问报文

       差错报告报文有5种：终点不可达

源点抑制

时间超时

参数问题

改变路由（重定向）

询问报文有2种：回送请求和回答报文

                            时间戳请求和回答报文

 

 

Ping命名只能检测是是否通

Pathping命令能跟踪数据包的路径，可以知道在哪个地方不通，还能计算丢包率

丢包率分为在路由器转的时候的丢包率和在线路上传输的时候的丢包率

 

 

 

 

动态路由协议（不用管理员静态添加路由表）：网络规模大则用动态路由协议

1.RIP协议（最早）：

周期性广播：30秒

通过条数计算最佳路径，当需要17跳是则认为不可到达

但是最佳路径还要考虑带宽，算法比较简单

 

2.OSPF协议（内部网关协议）（开放式最短路径优先协议）：用于Internet

OSPF为开放式（各个厂家都支持）

度量值：带宽

支持多区域：分区域（2级结构）――分治思想

触发式跟新：邻居表：向邻居发一个hello包表示还在

                     链路状态表：交换所有的邻居表算开销和带宽

                     计算路由表：使之不产生环路

支持负载均衡

直接用IP数据报传输路由表

支持可变长子网的划分

 

 

 

反转掩码：掩码的反码

静态路由的优先级>OSPF协议>RIP协议

 

 

外部网关协议（BGP）：

RIP协议和OSPF协议都是自制系统协议（保证一个系统内的正确寻址）

BGP协议用于各个系统之间选择路径

每个自治系统有一个发言人

BGP建立时交换整个路由表，之后只交换变化部分  

 

 

虚拟专用网络VPN：

实质是在互联网上传私有数据的方式，并通过拨号等方式保证安全

 

 

网络地址转换NAT：端口映射

使公网地址可以访问内网的地址
--------------------- 
作者：PSJ_14 
来源：CSDN 
原文：https://blog.csdn.net/psj_1161885042/article/details/79336220 
版权声明：本文为博主原创文章，转载请附上博文链接！